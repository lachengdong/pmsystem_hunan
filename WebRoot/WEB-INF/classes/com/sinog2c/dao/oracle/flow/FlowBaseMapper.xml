<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.sinog2c.dao.api.flow.FlowBaseMapper">
	<resultMap id="BaseResultMap" type="com.sinog2c.model.flow.FlowBase">
		<result column="FLOWDRAFTID" jdbcType="VARCHAR" property="flowdraftid" />
		<result column="FLOWID" jdbcType="VARCHAR" property="flowid" />
		<result column="FLOWDEFID" jdbcType="VARCHAR" property="flowdefid" />
		<result column="APPLYID" jdbcType="VARCHAR" property="applyid" />
		<result column="APPLYNAME" jdbcType="VARCHAR" property="applyname" />
		<result column="APPLYDATETIME" jdbcType="TIMESTAMP" property="applydatetime" />
		<result column="STARTDATETIME" jdbcType="TIMESTAMP" property="startdatetime" />
		<result column="ENDDATETIME" jdbcType="TIMESTAMP" property="enddatetime" />
		<result column="CONENT" jdbcType="VARCHAR" property="conent" />
		<result column="ISLOCKED" jdbcType="DECIMAL" property="islocked" />
		<result column="TEXT1" jdbcType="VARCHAR" property="text1" />
		<result column="TEXT2" jdbcType="VARCHAR" property="text2" />
		<result column="TEXT3" jdbcType="VARCHAR" property="text3" />
		<result column="TEXT4" jdbcType="VARCHAR" property="text4" />
		<result column="TEXT5" jdbcType="VARCHAR" property="text5" />
		<result column="TEXT6" jdbcType="VARCHAR" property="text6" />
		<result column="TEXT7" jdbcType="VARCHAR" property="text7" />
		<result column="TEXT8" jdbcType="VARCHAR" property="text8" />
		<result column="TEXT9" jdbcType="VARCHAR" property="text9" />
		<result column="TEXT10" jdbcType="VARCHAR" property="text10" />
		<result column="TEXT11" jdbcType="VARCHAR" property="text11" />
		<result column="TEXT12" jdbcType="VARCHAR" property="text12" />
		<result column="TEXT13" jdbcType="VARCHAR" property="text13" />
		<result column="TEXT14" jdbcType="VARCHAR" property="text14" />
		<result column="TEXT15" jdbcType="VARCHAR" property="text15" />
		<result column="TEXT16" jdbcType="VARCHAR" property="text16" />
		<result column="TEXT17" jdbcType="VARCHAR" property="text17" />
		<result column="TEXT18" jdbcType="VARCHAR" property="text18" />
		<result column="TEXT19" jdbcType="VARCHAR" property="text19" />
		<result column="TEXT20" jdbcType="VARCHAR" property="text20" />
		<result column="TEXT21" jdbcType="VARCHAR" property="text21" />
		<result column="TEXT22" jdbcType="VARCHAR" property="text22" />
		<result column="TEXT23" jdbcType="VARCHAR" property="text23" />
		<result column="TEXT24" jdbcType="VARCHAR" property="text24" />
		<result column="TEXT25" jdbcType="VARCHAR" property="text25" />
		<result column="TEXT26" jdbcType="VARCHAR" property="text26" />
		<result column="TEXT27" jdbcType="VARCHAR" property="text27" />
		<result column="TEXT28" jdbcType="VARCHAR" property="text28" />
		<result column="TEXT29" jdbcType="VARCHAR" property="text29" />
		<result column="TEXT30" jdbcType="VARCHAR" property="text30" />
		<result column="INT1" jdbcType="DECIMAL" property="int1" />
		<result column="INT2" jdbcType="DECIMAL" property="int2" />
		<result column="INT3" jdbcType="DECIMAL" property="int3" />
		<result column="INT4" jdbcType="DECIMAL" property="int4" />
		<result column="INT5" jdbcType="DECIMAL" property="int5" />
		<result column="INT6" jdbcType="DECIMAL" property="int6" />
		<result column="INT7" jdbcType="DECIMAL" property="int7" />
		<result column="INT8" jdbcType="DECIMAL" property="int8" />
		<result column="INT9" jdbcType="DECIMAL" property="int9" />
		<result column="INT10" jdbcType="DECIMAL" property="int10" />
		<result column="DEPARTID" jdbcType="VARCHAR" property="departid" />
		<result column="FJQUSER" jdbcType="VARCHAR" property="fjquser" />
		<result column="OPNAME" jdbcType="VARCHAR" property="opname" />
		<result column="LASTOPNAME" jdbcType="VARCHAR" property="lastopname" />
		<result column="OPID" jdbcType="VARCHAR" property="opid" />
		<result column="OPTIME" jdbcType="TIMESTAMP" property="optime" />

		<result column="SN" jdbcType="DECIMAL" property="sn" />
		<result column="ISREVIEW" jdbcType="DECIMAL" property="isreview" />
		<result column="FLOWLOCKED" jdbcType="VARCHAR" property="flowlocked" />
		<result column="LOCKTYPE" jdbcType="VARCHAR" property="locktype" />
		<result column="LOCKREASON" jdbcType="VARCHAR" property="lockreason" />
		<result column="SERVICESENDER" jdbcType="DECIMAL" property="servicesender" />
		
		<result column="ORGID" jdbcType="VARCHAR" property="orgid" />
		<result column="FLOWSN" jdbcType="VARCHAR" property="flowsn" />
		<result column="CURRNODEID" jdbcType="VARCHAR" property="currnodeid" />
		<result column="COMMENTTEXT" jdbcType="VARCHAR" property="commenttext" />
		<result column="OPERATETYPE" jdbcType="VARCHAR" property="operatetype" />
		<result column="STATE" jdbcType="DECIMAL" property="state" />
		<result column="OPERATEIP" jdbcType="VARCHAR" property="operateip" />
		<result column="OPERATEID" jdbcType="VARCHAR" property="operateid" />
		<result column="RESID" jdbcType="VARCHAR" property="resid" />
		<result column="EXPLAIN" jdbcType="VARCHAR" property="explain" />
		<result column="CASEDESC" jdbcType="VARCHAR" property="casedesc" />
		<result column="OPINIONNODE" jdbcType="VARCHAR" property="opinionnode" />
		<result column="EDITNODES" jdbcType="VARCHAR" property="editnodes" />
		<result column="FILTERORG" jdbcType="VARCHAR" property="filterorg" />
		<result column="BRANCHTYPE" jdbcType="VARCHAR" property="branchtype" />
		<result column="BRANCHVALUE" jdbcType="VARCHAR" property="branchvalue" />
		<result column="FLOWSTATUS" jdbcType="VARCHAR" property="flowstatus" />
		
	</resultMap>
	<insert id="insert" parameterType="com.sinog2c.model.flow.FlowBase">
		insert into TBFLOW_BASE
		(
			FLOWDRAFTID, FLOWID, FLOWDEFID, APPLYID,
			APPLYNAME, APPLYDATETIME,
			STARTDATETIME,
			ENDDATETIME, CONENT, ISLOCKED,
			TEXT1, TEXT2, TEXT3,
			TEXT4, TEXT5, TEXT6,
			TEXT7, TEXT8, TEXT9,
			TEXT10, TEXT11, TEXT12,
			TEXT13, TEXT14, TEXT15,
			TEXT16, TEXT17, TEXT18,
			TEXT19, TEXT20, TEXT21,
			TEXT22, TEXT23, TEXT24,
			TEXT25, INT1, INT2,
			INT3, INT4,
			INT5,INT6,INT7,INT8,INT9,INT10,DEPARTID,FJQUSER,
			OPNAME,OPID, OPTIME,
			SN,ISREVIEW,FLOWLOCKED,LOCKTYPE,LOCKREASON,
			SERVICESENDER,ORGID,FLOWSN,CURRNODEID,
			COMMENTTEXT,OPERATETYPE,STATE,OPERATEIP,OPERATEID,
			RESID,EXPLAIN,CASEDESC,OPINIONNODE,EDITNODES,
			FILTERORG,BRANCHTYPE,BRANCHVALUE,FLOWSTATUS,
			JAILCASECHG,PROVINCECASECHG
		)
		values
		(
			#{flowdraftid,jdbcType=VARCHAR},#{flowid,jdbcType=VARCHAR},
			#{flowdefid,jdbcType=VARCHAR},
			#{applyid,jdbcType=VARCHAR},
			#{applyname,jdbcType=VARCHAR},
			#{applydatetime,jdbcType=TIMESTAMP},
			#{startdatetime,jdbcType=TIMESTAMP},
			#{enddatetime,jdbcType=TIMESTAMP}, #{conent,jdbcType=VARCHAR},
			#{islocked,jdbcType=DECIMAL},
			#{text1,jdbcType=VARCHAR},
			#{text2,jdbcType=VARCHAR}, #{text3,jdbcType=VARCHAR},
			#{text4,jdbcType=VARCHAR}, #{text5,jdbcType=VARCHAR},
			#{text6,jdbcType=VARCHAR},
			#{text7,jdbcType=VARCHAR},
			#{text8,jdbcType=VARCHAR}, #{text9,jdbcType=VARCHAR},
			#{text10,jdbcType=VARCHAR}, #{text11,jdbcType=VARCHAR},
			#{text12,jdbcType=VARCHAR},
			#{text13,jdbcType=VARCHAR},
			#{text14,jdbcType=VARCHAR}, #{text15,jdbcType=VARCHAR},
			#{text16,jdbcType=VARCHAR}, #{text17,jdbcType=VARCHAR},
			#{text18,jdbcType=VARCHAR},
			#{text19,jdbcType=VARCHAR},
			#{text20,jdbcType=VARCHAR}, #{text21,jdbcType=VARCHAR},
			#{text22,jdbcType=VARCHAR}, #{text23,jdbcType=VARCHAR},
			#{text24,jdbcType=VARCHAR},
			#{text25,jdbcType=VARCHAR},#{int1,jdbcType=DECIMAL},
			#{int2,jdbcType=DECIMAL},#{int3,jdbcType=DECIMAL},
			#{int4,jdbcType=DECIMAL},#{int5,jdbcType=DECIMAL},
			#{int6,jdbcType=DECIMAL},#{int7,jdbcType=DECIMAL},
			#{int8,jdbcType=DECIMAL},#{int9,jdbcType=DECIMAL},
			#{int10,jdbcType=DECIMAL},
			#{departid,jdbcType=VARCHAR},
			#{fjquser,jdbcType=VARCHAR},
			#{opname,jdbcType=VARCHAR},
			#{opid,jdbcType=VARCHAR}, #{optime,jdbcType=TIMESTAMP},
			#{sn,jdbcType=DECIMAL}, #{isreview,jdbcType=DECIMAL},
			#{flowlocked,jdbcType=VARCHAR}, #{locktype,jdbcType=VARCHAR},
			#{lockreason,jdbcType=VARCHAR},
			
			#{servicesender,jdbcType=DECIMAL},
			#{orgid,jdbcType=VARCHAR},
			#{flowsn,jdbcType=VARCHAR},
			#{currnodeid,jdbcType=VARCHAR},
			#{commenttext,jdbcType=VARCHAR},
			#{operatetype,jdbcType=VARCHAR},
			#{state,jdbcType=DECIMAL},
			#{operateip,jdbcType=VARCHAR},
			#{operateid,jdbcType=VARCHAR},
			#{resid,jdbcType=VARCHAR},
			#{explain,jdbcType=VARCHAR},
			#{casedesc,jdbcType=VARCHAR},
			#{opinionnode,jdbcType=VARCHAR},
			#{editnodes,jdbcType=VARCHAR},
			#{filterorg,jdbcType=VARCHAR},
			#{branchtype,jdbcType=VARCHAR},
			#{branchvalue,jdbcType=VARCHAR},
			#{flowstatus,jdbcType=VARCHAR},
			#{jailcasechg,jdbcType=VARCHAR},
			#{provincecasechg,jdbcType=VARCHAR}
		)
	</insert>
  	<!-- 宁夏分离 批量签章子内容 -->
	<select id="selectSignaByCaseNum_nx" resultType="Map" parameterType="Map">
		select * from TBFLOW_BASE a 
		WHERE flowdefid=#{flowdefid} 
		AND text6=#{casenum}
		AND NOT EXISTS (SELECT 1 FROM Tbflow_Base b 
			WHERE b.flowdefid=a.flowdefid AND b.text6=a.text6 
			AND b.departid=a.departid
			<if test="casetype!=null and casetype!=''"> 
			AND b.text7=a.text7 AND a.text7=#{casetype} 
			</if> 
			AND b.optime>a.optime) 
			<if test="departid!=null and departid!=''">
		AND EXISTS (SELECT 1 FROM TBPRISONER_BASE_CRIME info 
			where a.applyid=info.crimid and 
			(info.orgid in (SELECT dorgid FROM TBFLOW_ORG_ORG where orgid = #{departid})
			or info.orgid1 in (SELECT dorgid FROM TBFLOW_ORG_ORG where orgid = #{departid})
			or info.orgid2 in (SELECT dorgid FROM TBFLOW_ORG_ORG where orgid = #{departid}))
		)
		</if>
		<if test="casetype!=null and casetype!=''"> 
		AND a.text7=#{casetype}
		</if>
	</select>
  <!-- 根据流程ID更新数据 -->
  <update id="updateById" parameterType="String">
  		update tbflow_base set islocked = #{islocked},opid = #{suid},opname = #{opname} where flowdraftid = #{flowdraftid}
  </update>
  
  <!-- 根据流程ID更新数据 -->
  <update id="updateByFlowdraftids" parameterType="String">
  		update tbflow_base set islocked = #{islocked},opid = #{suid},opname = #{opname} where flowdraftid in (${flowdraftids})
  </update>
  
  <update id="updateFlowBaseAfterWithdraw" parameterType="Map">
  		update tbflow set state = 1
  		where flowdraftid = #{flowdraftid} and optime = (select max(optime) as maxoptime from tbflow tb where tb.flowdraftid = #{flowdraftid})
  </update>
  
  <update id="setDiscussionDate" parameterType="Map">
  	update tbflow_base 
		<set> 
	       <if test="endcasedate != null">
	        	text13 = #{endcasedate},
	       </if> 
	       <if test="xuanpandate != null">
	        	text14 = #{xuanpandate},
	       </if> 
	       <if test="discussiondate != null">
	        	text15 = #{discussiondate},
	       </if>
	       <if test="filedate != null">
	        	text17 = #{filedate},
	       </if>
	       <if test="text18 != null">
	        TEXT18 = #{text18,jdbcType=VARCHAR},
	      </if>
	      <if test="text19 != null">
	        TEXT19 = #{text19,jdbcType=VARCHAR},
	      </if>
	      <if test="text20 != null">
	        TEXT20 = #{text20,jdbcType=VARCHAR},
	      </if>
	      <if test="text21 != null">
	        TEXT21 = #{text21,jdbcType=VARCHAR},
	      </if>
	      <if test="text22 != null">
	        TEXT22 = #{text22,jdbcType=VARCHAR},
	      </if>
	      <if test="text23 != null">
	        TEXT23 = #{text23,jdbcType=VARCHAR},
	      </if>
	      <if test="text24 != null">
	        TEXT24 = #{text24,jdbcType=VARCHAR},
	      </if>
	      <if test="text25 != null">
	        TEXT25 = #{text25,jdbcType=VARCHAR},
	      </if>
	      <if test="int1 != null">
	        INT1 = #{int1,jdbcType=DECIMAL},
	      </if>
	      <if test="int2 != null">
	        INT2 = #{int2,jdbcType=DECIMAL},
	      </if>
	      <if test="int3 != null">
	        INT3 = #{int3,jdbcType=DECIMAL},
	      </if>
	      <if test="int4 != null">
	        INT4 = #{int4,jdbcType=DECIMAL},
	      </if>
	      <if test="int5 != null">
	        INT5 = #{int5,jdbcType=DECIMAL},
	      </if>
	      <if test="int6 != null">
	        <!-- 把int6批次的值，赋值给int5是什么意思？修改之前代码：INT5 = #{int6,jdbcType=DECIMAL}, 修改人：mushuhong-->
	        INT6 = #{int6,jdbcType=DECIMAL},
	      </if>
	      <if test="int7 != null">
	        INT7 = #{int7,jdbcType=DECIMAL},
	      </if>
	      <if test="int8 != null">
	        INT8 = #{int8,jdbcType=DECIMAL},
	      </if>
	      <if test="int9 != null">
	        INT9 = #{int9,jdbcType=DECIMAL},
	      </if>
	      <if test="int10!= null">
	        INT10 = #{int10,jdbcType=DECIMAL},
	      </if>
	      <if test="isreview !=null">
	      	isreview = #{isreview,jdbcType=VARCHAR},
	      </if>
       </set>
  		where flowdraftid in (${data})
  </update>
  
  <!-- 根据流程草稿ID更新数据 -->
   <update id="updateSensitiveByFlowdraftid" parameterType="com.sinog2c.model.flow.FlowBase">
		update TBFLOW_BASE
		<set>
			<if test="flowid != null">
				FLOWID = #{flowid,jdbcType=VARCHAR},
			</if>
			<if test="flowdefid != null">
				FLOWDEFID = #{flowdefid,jdbcType=VARCHAR},
			</if>
			<if test="applyid != null">
				APPLYID = #{applyid,jdbcType=VARCHAR},
			</if>
			<if test="applyname != null">
				APPLYNAME = #{applyname,jdbcType=VARCHAR},
			</if>
			<if test="applydatetime != null">
				APPLYDATETIME = #{applydatetime,jdbcType=TIMESTAMP},
			</if>
			<if test="startdatetime != null">
				STARTDATETIME = #{startdatetime,jdbcType=TIMESTAMP},
			</if>
			<if test="enddatetime != null">
				ENDDATETIME = #{enddatetime,jdbcType=TIMESTAMP},
			</if>
			<if test="conent != null">
				CONENT = #{conent,jdbcType=VARCHAR},
			</if>
			<if test="islocked != null">
				ISLOCKED = #{islocked,jdbcType=DECIMAL},
			</if>

			<if test="text1 != null">
				TEXT1 = #{text1,jdbcType=VARCHAR},
			</if>
			<if test="text2 != null">
				TEXT2 = #{text2,jdbcType=VARCHAR},
			</if>
			<if test="text3 != null">
				TEXT3 = #{text3,jdbcType=VARCHAR},
			</if>
			<if test="text4 != null">
				TEXT4 = #{text4,jdbcType=VARCHAR},
			</if>
			<if test="text5 != null">
				TEXT5 = #{text5,jdbcType=VARCHAR},
			</if>

			<if test="text6 != null and text6 != ''">
				TEXT6 = #{text6,jdbcType=VARCHAR},
			</if>

			<if test="text7 != null">
				TEXT7 = #{text7,jdbcType=VARCHAR},
			</if>
			<if test="text8 != null">
				TEXT8 = #{text8,jdbcType=VARCHAR},
			</if>
			<if test="text9 != null">
				TEXT9 = #{text9,jdbcType=VARCHAR},
			</if>
			<if test="text10 != null and text10 !=''">
				TEXT10 = #{text10,jdbcType=VARCHAR},
			</if>
			<if test="text11 != null and text11!=''">
				TEXT11 = #{text11,jdbcType=VARCHAR},
			</if>
			<if test="text12 != null and text12!=''">
				TEXT12 = #{text12,jdbcType=VARCHAR},
			</if>
			<if test="text13 != null and text13!=''">
				TEXT13 = #{text13,jdbcType=VARCHAR},
			</if>
			<if test="text14 != null and text14!=''">
				TEXT14 = #{text14,jdbcType=VARCHAR},
			</if>
			<if test="text15 != null and text15!=''">
				TEXT15 = #{text15,jdbcType=VARCHAR},
			</if>
			<if test="text16 != null">
				TEXT16 = #{text16,jdbcType=VARCHAR},
			</if>
			<if test="text17 != null">
				TEXT17 = #{text17,jdbcType=VARCHAR},
			</if>
			<if test="text18 != null">
				TEXT18 = #{text18,jdbcType=VARCHAR},
			</if>
			<if test="text19 != null">
				TEXT19 = #{text19,jdbcType=VARCHAR},
			</if>
			<if test="text20 != null">
				TEXT20 = #{text20,jdbcType=VARCHAR},
			</if>
			<if test="text21 != null">
				TEXT21 = #{text21,jdbcType=VARCHAR},
			</if>
			<if test="text22 != null">
				TEXT22 = #{text22,jdbcType=VARCHAR},
			</if>
			<if test="text23 != null and text23!=''">
				TEXT23 = #{text23,jdbcType=VARCHAR},
			</if>
			<if test="text24 != null">
				TEXT24 = #{text24,jdbcType=VARCHAR},
			</if>
			<if test="text25 != null">
				TEXT25 = #{text25,jdbcType=VARCHAR},
			</if>
			<if test="int1 != null">
				INT1 = #{int1,jdbcType=DECIMAL},
			</if>
			<if test="int2 != null">
				INT2 = #{int2,jdbcType=DECIMAL},
			</if>
			<if test="int3 != null">
				INT3 = #{int3,jdbcType=DECIMAL},
			</if>
			<if test="int4 != null">
				INT4 = #{int4,jdbcType=DECIMAL},
			</if>
			<if test="int5 != null">
				INT5 = #{int5,jdbcType=DECIMAL},
			</if>
			<if test="int6 != null">
				int6 = #{int6,jdbcType=DECIMAL},
			</if>
			<if test="int7 != null">
				int7 = #{int7,jdbcType=DECIMAL},
			</if>
			<if test="int8 != null">
				int8 = #{int8,jdbcType=DECIMAL},
			</if>
			<if test="int9 != null">
				int9 = #{int9,jdbcType=DECIMAL},
			</if>
			<if test="int10 != null">
				int10 = #{int10,jdbcType=DECIMAL},
			</if>
			<if test="fjquser != null">
				FJQUSER = #{fjquser,jdbcType=VARCHAR},
			</if>
			<if test="opname != null">
				OPNAME = #{opname,jdbcType=VARCHAR},
			</if>
			<if test="lastopname != null and lastopname != ''">
				LASTOPNAME = #{lastopname,jdbcType=VARCHAR},
			</if>
			<if test="opid != null">
				OPID = #{opid,jdbcType=VARCHAR},
			</if>
			<if test="optime != null">
				OPTIME = #{optime,jdbcType=TIMESTAMP},
			</if>
			<if test="text26 != null">
				TEXT26 = #{text26,jdbcType=VARCHAR},
			</if>
			<if test="text27 != null">
				TEXT27 = #{text27,jdbcType=VARCHAR},
			</if>
			<if test="text28 != null">
				TEXT28 = #{text28,jdbcType=VARCHAR},
			</if>
			<if test="text29 != null">
				TEXT29 = #{text29,jdbcType=VARCHAR},
			</if>
			<if test="text30 != null">
				TEXT30 = #{text30,jdbcType=VARCHAR},
			</if>
			<if test="text31 != null">
				TEXT31 = #{text31,jdbcType=VARCHAR},
			</if>
			
			<if test="servicesender != null">
				SERVICESENDER = #{servicesender,jdbcType=DECIMAL},
			</if>
			<if test="flowsn != null">
				FLOWSN = #{flowsn,jdbcType=VARCHAR},
			</if>
			<if test="currnodeid != null">
				CURRNODEID = #{currnodeid,jdbcType=VARCHAR},
			</if>
			<if test="commenttext != null">
				COMMENTTEXT = #{commenttext,jdbcType=VARCHAR},
			</if>
			<if test="operatetype != null">
				OPERATETYPE = #{operatetype,jdbcType=VARCHAR},
			</if>
			<if test="state != null">
				STATE = #{state,jdbcType=DECIMAL},
			</if>
			<if test="operateip != null">
				OPERATEIP = #{operateip,jdbcType=VARCHAR},
			</if>
			<if test="operateid != null">
				OPERATEID = #{operateid,jdbcType=VARCHAR},
			</if>
			<if test="resid != null">
				RESID = #{resid,jdbcType=VARCHAR},
			</if>
			<if test="explain != null">
				EXPLAIN = #{explain,jdbcType=VARCHAR},
			</if>
			<if test="casedesc != null">
				CASEDESC = #{casedesc,jdbcType=VARCHAR},
			</if>
			<if test="opinionnode != null">
				OPINIONNODE = #{opinionnode,jdbcType=VARCHAR},
			</if>
			<if test="editnodes != null">
				EDITNODES = #{editnodes,jdbcType=VARCHAR},
			</if>
			<if test="filterorg != null">
				FILTERORG = #{filterorg,jdbcType=VARCHAR},
			</if>
			<if test="branchtype != null">
				BRANCHTYPE = #{branchtype,jdbcType=VARCHAR},
			</if>
			<if test="branchvalue != null">
				BRANCHVALUE = #{branchvalue,jdbcType=VARCHAR},
			</if>
			<if test="flowstatus != null">
				FLOWSTATUS = #{flowstatus,jdbcType=VARCHAR},
			</if>
			<if test="jailcasechg != null and jailcasechg != ''">
		        JAILCASECHG = #{jailcasechg,jdbcType=VARCHAR},
		    </if>
		    <if test="provincecasechg != null and provincecasechg != ''">
		        PROVINCECASECHG = #{provincecasechg,jdbcType=VARCHAR},
		    </if>
		</set>
		where flowdraftid = #{flowdraftid,jdbcType=VARCHAR}
	</update>
  
  
	<select id="countAll" resultType="int">  <!-- 查询表中记录总数 -->
		select count(*) c from tbflow_base
	</select>

	<select id="selectAll" resultType="com.sinog2c.model.flow.FlowBase">    <!-- 查询表中的所有流程信息 -->
		select * from tbflow_base order by flowdefid asc
	</select>
	<select id="findById" parameterType="String"
		resultType="com.sinog2c.model.flow.FlowBase"> <!-- 根据流程ID查找流程信息 -->
		select * from tbflow_base where flowid=#{flowid}
	</select>
	
	<select id="findUvFlowByFlowdraftid" resultType="Map">
		select * from UV_Flow where flowdraftid=#{flowdraftid}
	</select>
	
	<select id="getFlowBaseByFlowdraftid" resultType="com.sinog2c.model.flow.FlowBase">    <!-- 查询表中的所有流程信息 -->
		select * from tbflow_base t where t.flowdraftid = #{flowdraftid}
	</select>
	
	<select id="getFlowBaseByFlowdraftid2" resultType="com.sinog2c.model.flow.FlowBase">    <!-- 查询表中的所有流程信息 -->
		select * from tbflow_base t
		where t.flowdraftid in (${flowdraftids})
		<if test="flowlocked != null and flowlocked!=''">
			and t.flowlocked = #{flowlocked,jdbcType=VARCHAR}
		</if>
		<if test="locktype != null and locktype!=''">
			and t.locktype = #{locktype,jdbcType=VARCHAR}
		</if>
		order by t.OPID
	</select>
	
	<select id="getCrimeByFlowdraftids"  parameterType="Map" resultType="Map">
		select tbi.crimid, tbi.DEPARTID from tbflow_base t, tbprisoner_baseinfo tbi where t.flowdraftid in (${flowdraftids})  and t.applyid=tbi.crimid
	</select>
	
	<select id="getFlowBaseListByFlowdraftids" parameterType="map" resultType="Map" >
		${sqltext}
	</select>
	
	<select id="getFlowBaseByMap" resultType="com.sinog2c.model.flow.FlowBase">    <!-- 查询表中的所有流程信息 -->
		select * from tbflow_base t where t.flowdraftid=#{flowdraftid} 
	</select>
	
	
	<select id="findByCondition" parameterType="Map" resultType="com.sinog2c.model.flow.FlowBase">
		select * from( 
			select a.*, rownum rn from
	    		(select * from(
				    select tb.*,tf.nodeid,tf.state
				    <if test="nodeids!=null and nodeids!=''">
				    , (case when tf.nodeid in (${nodeids}) and tf.state in(-1,0,2) then '1' else '0' end) as editstate
				   	</if> 
					from (select t0.* from TBFLOW_BASE t0 where t0.applyid=#{applyid} and t0.flowdefid=#{flowdefid}) tb,
					(SELECT T1.nodeid,T1.orgid,T1.state,T1.startsummry,T1.endsummry,T1.commenttext,T1.opname,T1.optime,T1.FLOWDRAFTID
					          FROM TBFLOW T1  WHERE 1 = 1 AND NOT EXISTS 
					          (SELECT 1 FROM TBFLOW T2 WHERE T1.FLOWDRAFTID = T2.FLOWDRAFTID AND T2.OPTIME > T1.OPTIME)) tf where  tb.flowdraftid=tf.flowdraftid
					<if test="orgid!=null and orgid!=''">  
				        and tf.orgid in (select  a.dorgid from TBFLOW_ORG_ORG a  where a.orgid =#{orgid})
				    </if>
					 and exists ( select 1 from tbflow t1 where t1.flowdraftid=tb.flowdraftid 
					<if test="nodeids!=null and nodeids!=''">  
					 	and t1.nodeid in (${nodeids})
					</if>
					 )
			 )
		    <if test="sortField!=null and sortField!=''" > 	
		     	order by ${sortField}  ${sortOrder}
		    </if>
	    ) a 
	    <if test="end!=null and end!=''">
	   		where rownum &lt;= #{end}
	   	</if> 
	    )
	   	<if test="start!=null and start!=''">
	   		where  rn &gt;= #{start}
	   	</if>
	</select>
	
	
	<select id="countAllByCondition" parameterType="Map" resultType="int">
		select count(tb.applyid)from (
			select t0.* from TBFLOW_BASE t0 where 
				 <if test="applyid!=null and applyid!=''">  
				 	 t0.applyid=#{applyid} and 
				 </if>
				 <if test="key!=null and key!=''">  
				 	 t0.conent=#{key} and 
				 </if>
				 t0.flowdefid=#{flowdefid}) tb,
			(SELECT T1.nodeid,T1.orgid,T1.state,T1.startsummry,T1.endsummry,T1.commenttext,T1.opname,T1.optime,T1.FLOWDRAFTID
			          FROM TBFLOW T1 WHERE 1 = 1 AND NOT EXISTS
			          (SELECT 1 FROM TBFLOW T2 WHERE T1.FLOWDRAFTID = T2.FLOWDRAFTID AND T2.OPTIME > T1.OPTIME)) tf
			where  tb.flowdraftid=tf.flowdraftid
			<if test="orgid!=null and orgid!=''">  
	        	and tf.orgid in (select  a.dorgid from TBFLOW_ORG_ORG a  where a.orgid =#{orgid})
	    	</if>
	    	<if test="jqid!=null and jqid!=''">
				and tf.orgid=#{jqid}
	    	</if>
			 	and exists ( select 1 from tbflow t1 where t1.flowdraftid=tb.flowdraftid 
			<if test="nodeids!=null and nodeids!=''">  
			 	and t1.nodeid in (${nodeids})
			</if>
 		)
    </select>
    
    
    <select id="findByMapCondition" parameterType="Map" resultType="Map">
		select * from( 
			select a.* from(
	    		select * from(
				    select decode(tb.flowid,null,'未审批','','未审批',
				    	   		decode(tf.nodeid,'1','已通过','-1','未通过',
				    	   		decode(tf.state,'3','未通过','2','被退回','审批中'))) as status,
				    	   tf.commenttext,tb.*,rownum as rn,tf.nodeid
				    <if test="nodeids!=null and nodeids!=''">
				    	, (case when tf.nodeid in (${nodeids}) and tf.state in(-1,0,2) then '1' else '0' end) as editstate
				    </if> 
						from 
						(select t0.* from TBFLOW_BASE t0 where
								 <if test="applyid!=null and applyid!=''">  
								 	 t0.applyid=#{applyid} and 
								 </if>
								 <if test="key!=null and key!=''">  
								 	(t0.applyname like '%'||#{key}||'%' or t0.applyid like '%'||#{key}||'%' or t0.conent like '%'||#{key}||'%') and
								 </if>    
						 		 t0.flowdefid=#{flowdefid}  order by t0.optime asc) tb,
						(SELECT T1.nodeid,T1.orgid,T1.state,T1.startsummry,T1.endsummry,T1.commenttext,T1.opname,T1.optime,T1.FLOWDRAFTID
						          FROM TBFLOW T1 WHERE 1 = 1 AND NOT EXISTS
						          (SELECT 1 FROM TBFLOW T2 WHERE T1.FLOWDRAFTID = T2.FLOWDRAFTID AND T2.OPTIME > T1.OPTIME)) tf
						           where tb.flowdraftid=tf.flowdraftid
						<if test="orgid!=null and orgid!=''">  
				        	and tf.orgid in (select  a.dorgid from TBFLOW_ORG_ORG a  where a.orgid =#{orgid})
				       	</if>
				    	<if test="jqid!=null and jqid!=''">
				    		and tf.orgid=#{jqid}
				    	</if>
				    	<if test="nodeids!=null and nodeids!=''">  
						 and exists ( select 1 from tbflow t1 where t1.flowdraftid=tb.flowdraftid and t1.nodeid in (${nodeids}) )
						 </if>
			 )
		    <if test="sortField!=null and sortField!=''" > 	
		     	order by ${sortField}  ${sortOrder}
		    </if>
	    ) a 
	    <if test="end!=null and end!=''">
	   		where rownum &lt;= #{end}
	   	</if> 
	    )
	   	<if test="start!=null and start!=''">
	   		where  rn &gt;= #{start}
	   	</if>
	</select>
	
	<select id="findByMapConditionCount" parameterType="Map" resultType="int">
    	select count(*) from(
			    select tb.*,tf.nodeid,tf.state
			    <if test="nodeids!=null and nodeids!=''">
			    	, (case when tf.nodeid in (${nodeids}) and tf.state in(-1,0,2) then '1' else '0' end) as editstate
			    </if> 
					from 
					(select t0.* from TBFLOW_BASE t0 where
							 <if test="applyid!=null and applyid!=''">  
							 	 t0.applyid=#{applyid} and 
							 </if>
							 <if test="key!=null and key!=''">  
							 	(t0.applyname like '%'||#{key}||'%' or t0.applyid like '%'||#{key}||'%') and
							 </if>    
					 		 t0.flowdefid=#{flowdefid}) tb,
					(SELECT T1.nodeid,
					               T1.orgid,
					               T1.state,
					               T1.startsummry,
					               T1.endsummry,
					               T1.commenttext,
					               T1.opname,
					               T1.optime,
					               T1.FLOWDRAFTID
					          FROM TBFLOW T1
					         WHERE 1 = 1
					               AND NOT EXISTS
					                          (SELECT 1
					                             FROM TBFLOW T2
					                            WHERE T1.FLOWDRAFTID = T2.FLOWDRAFTID
					                                  AND T2.OPTIME > T1.OPTIME)) tf
					where  tb.flowdraftid=tf.flowdraftid
					<if test="orgid!=null and orgid!=''">  
			        	and tf.orgid in (select  a.dorgid from TBFLOW_ORG_ORG a  where a.orgid =#{orgid})
			       	</if>
			    	<if test="jqid!=null and jqid!=''">
			    		and tf.orgid=#{jqid}
			    	</if>
			    	<if test="nodeids!=null and nodeids!=''">  
					 and exists ( select 1 from tbflow t1 where t1.flowdraftid=tb.flowdraftid and t1.nodeid in (${nodeids}) )
					 </if>
		 )
	</select>
	
	
	<select id="countAllByMapCondition" parameterType="Map" resultType="int">
		select count(tb.applyid)
			from 
			(select t0.* from TBFLOW_BASE t0 where t0.applyid=#{applyid} and t0.flowdefid=#{flowdefid}) tb,
			(SELECT T1.nodeid,
			               T1.orgid,
			               T1.state,
			               T1.startsummry,
			               T1.endsummry,
			               T1.commenttext,
			               T1.opname,
			               T1.optime,
			               T1.FLOWDRAFTID
			          FROM TBFLOW T1
			         WHERE 1 = 1
			               AND NOT EXISTS
			                          (SELECT 1
			                             FROM TBFLOW T2
			                            WHERE T1.FLOWDRAFTID = T2.FLOWDRAFTID
			                                  AND T2.OPTIME > T1.OPTIME)) tf
			where  tb.flowdraftid=tf.flowdraftid
			<if test="orgid!=null and orgid!=''">  
	        	and tf.orgid in (select  a.dorgid from TBFLOW_ORG_ORG a  where a.orgid =#{orgid})
	    	</if>
			 and exists ( select 1 from tbflow t1 where t1.flowdraftid=tb.flowdraftid and t1.nodeid in (${nodeids}) )
    </select>
    
    
    <select id="getSeq" resultType="java.util.HashMap">
	    <if test="sql!=null and sql!=''">${sql}</if> 
    </select>
    
    <select id="getMaxCaseNum" resultType="String">
	    select max(to_number(nvl(text6,a.curyear||'0')))
	     from TBFLOW_BASE t,
	    		 (select t.curyear 
	    		 	from TBXF_COMMUTEPAROLE_BATCH t 
	    		 	where t.departid = #{departid} and t.remark='999'
	    		 ) a
	    where t.departid = #{departid} 
	        and t.FLOWDEFID = #{flowdefid} 
	        and substr(text6,1,4) = a.curyear 
    	<if test="commutetype!=null and commutetype!=''">
			and t.int1 = #{commutetype}
		</if>
    </select>
    
    
    <select id="getMaxCaseNum4HuNanJailCommute" resultType="String">
	    select max(to_number(nvl(text6,a.curyear||'0')))
	     from TBFLOW_BASE t,
	    		 (select t.curyear 
	    		 	from TBXF_COMMUTEPAROLE_BATCH t 
	    		 	where t.departid = #{departid} and t.remark='999'
	    		 ) a
	    where t.departid = #{departid} 
	        and t.FLOWDEFID = #{flowdefid} 
	        and substr(text6,1,4) = a.curyear
	        and t.text7 = #{casetype}
    </select>
    
    
     <select id="getMaxBaowaiCaseNum" resultType="String">
	    select max(to_number(nvl(text6,#{curyear}||'0')))
	    from TBFLOW_BASE t
	    where t.departid = #{departid} 
	       and t.FLOWDEFID = #{flowdefid} 
	       and substr(text6,1,4) = #{curyear}
	       <if test="commutetype!=null and commutetype!=''">
				and t.int1 = #{commutetype}
		   </if>
    </select>
   
   <!-- 广东省局案件号的获取 --> 
    <select id="getSJMaxCaseNumForGD" resultType="String">
	    select max(to_number(nvl(text11,#{curyear}||'0')))
	    from TBFLOW_BASE t
	    where 1=1 
	       and t.FLOWDEFID = #{flowdefid} 
	       and substr(text11,1,4) = #{curyear}
	    <if test="casetype!=null and casetype!=''">
		   and t.text26 = #{casetype}
		</if>
    </select>
    
    <select id="getLastCaseNum" resultType="Integer">
	    select
		  case when ct>0 then to_number(substr(mx,5))
		    else 0 end
		  as casenum
		from (
		select count(tb.flowdraftid) as ct,max(to_number(tb.text6)) mx from tbflow_base tb where substr(tb.text6,1,4)=to_char(sysdate,'yyyy')
		 and tb.departid= #{departid}
		  and tb.flowdefid= #{flowdefid}
		)
    </select>
    
    <!-- 查询减刑假释、保外就医评审会同意 ，监狱长待审批节点N0004的数据 -->
	<select id="getPublicRecordsData" resultType="Map" parameterType="Map">
    SELECT *
  FROM (  SELECT t.name
            FROM TBXF_SCREENING tsr, uv_flow uf, TBXF_SENTENCEALTERATION t
           WHERE   uf.orgid = #{orgid}
                 AND flowdefid = #{flowdefid}
                 AND nodeid = #{nodeid}
           		 <if test="flowdefid=='other_zfjyjxjssp'">
					AND tsr.cstatus = '1'
                 	AND tsr.isdeclare = '2'
				 </if>
                 AND tsr.crimid = uf.applyid
                 AND uf.applyid = t.crimid
                 AND uf.state = '-1'
        ORDER BY TO_NUMBER (uf.text6))
	</select>
	
	<!-- 查询解回再审的数据 -->
	<select id="getJHZSData" resultType="Map" parameterType="Map">
	select decode(temp3.nodeid,'0','未审批','-1','未通过','1',decode(temp3.text2,null,'已通过','已终止'),DECODE (temp.flowid, NULL, '未审批','审批中')) as text3,
       temp.applyid,temp.applyname,temp.applydatetime,temp.flowid,temp.optime,temp.opname,temp.conent,temp3.text1,temp3.text2,temp3.flowsn,temp.flowdraftid 
 		 from (select *
          from (select a.*, rownum rn
                  from (select t1.*
                          from TBFLOW_BASE t1
                         where 1 = 1
                           and ((t1.flowid is not null and not exists
                                (select 1
                                    from TBFLOW_BASE t2
                                   where t2.flowid = t1.flowid
                                     and t2.optime > t1.optime)) or
                               (t1.flowid is null and not exists
                                (select 1
                                    from TBFLOW_BASE t2
                                   where t2.departid = t1.departid
                                     and t2.flowdefid = t1.flowdefid
                                     and t2.applyid = t1.applyid
                                     and t2.optime > t1.optime)))
                           and departid in
                               (select a.orgid
                                  from tbsys_orginfo a
                                 start with a.orgid = #{departId}
                                Connect By Prior a.orgid = a.porgid)
                           and flowdefid = #{flowdefid}
                           and applyid = #{applyid}
                         order by t1.optime asc) a
				 <if test="end!=null and end!=''">
	             	where rownum &lt;= #{end}
	        	 </if>                 
                 )
                 <if test="start!=null and start!=''">
             		where  rn &gt;= #{start}
       			 </if>
         ) temp,
       tbflow temp3
 	where temp.flowdraftid = temp3.flowdraftid(+)
   		and not exists (select 1
          from tbflow temp1
         where temp1.flowdraftid = temp3.flowdraftid
           and temp1.optime > temp3.optime)
	</select>	
	
	
	<select id="getJHZSDataCount" resultType="int" parameterType="Map">
	select count(*)
 		 from (select t1.*
                          from TBFLOW_BASE t1
                         where 1 = 1
                           and ((t1.flowid is not null and not exists
                                (select 1
                                    from TBFLOW_BASE t2
                                   where t2.flowid = t1.flowid
                                     and t2.optime > t1.optime)) or
                               (t1.flowid is null and not exists
                                (select 1
                                    from TBFLOW_BASE t2
                                   where t2.departid = t1.departid
                                     and t2.flowdefid = t1.flowdefid
                                     and t2.applyid = t1.applyid
                                     and t2.optime > t1.optime)))
                           and departid in
                               (select a.orgid
                                  from tbsys_orginfo a
                                 start with a.orgid = #{departId}
                                Connect By Prior a.orgid = a.porgid)
                           and flowdefid = #{flowdefid}
                           and applyid = #{applyid}
                         order by t1.optime asc
                 ) temp,
       tbflow temp3
 	where temp.flowdraftid = temp3.flowdraftid(+)
   		and not exists (select 1
          from tbflow temp1
         where temp1.flowdraftid = temp3.flowdraftid
           and temp1.optime > temp3.optime)
	</select>	
	
	<!-- 查询不予收监数据 -->
	<select id="getBaseListNotInforming" parameterType="Map" resultType="com.sinog2c.model.flow.FlowBase">
	SELECT *
  		FROM (SELECT a.*, ROWNUM rn
            FROM (  SELECT B.FLOWDRAFTID,B.NOdeid,B.OPNAME,B.OPTIME,B.applyid, B.CONENT,B.APPLYDATETIME,B.commenttext as text2,
                           NVL (B.FLOWID, 0) AS FLOWID, A.name as ORGID,
                           DECODE (B.NOdeid,'-1', '未通过', '0', '未审批', '1', '通过', DECODE (B.FLOWID,'1' ,'未审批','审批中')) AS text1
                        FROM (SELECT F1.FLOWDRAFTID , F1.NOdeid,F1.OPNAME,F1.OPTIME,F1.orgid,T3.applyid,T3.conent,T3.APPLYDATETIME,F1.commenttext,
                                     DECODE (F1.FLOWDRAFTID, NULL, F1.FLOWDRAFTID,DECODE (F1.FLOWID, '', '1', '2')) AS FLOWID
                                   FROM TBFLOW F1,
                                            ( SELECT TF.FLOWDRAFTID, MAX (TO_NUMBER(TF.FLOWSN)) FLOWSN   FROM TBFLOW TF  GROUP BY TF.FLOWDRAFTID) F2,
                                            (SELECT applyid, FLOWDRAFTID,CONENT,APPLYDATETIME  FROM TBFLOW_BASE T1
                                   WHERE 1 = 1 
                                               <if test="flowdefid!=null and flowdefid!=''">
                                                     AND flowdefid = #{flowdefid}
                                               </if>
                                      AND NOT EXISTS  (SELECT 1  FROM TBFLOW_BASE T2  WHERE T1.APPLYID = T2.APPLYID
                                                                 AND T1.FLOWDEFID =T2.FLOWDEFID AND T2.OPTIME >T1.OPTIME)) T3                        
                           WHERE     F1.FLOWDRAFTID = T3.FLOWDRAFTID  AND F1.FLOWDRAFTID = F2.FLOWDRAFTID
                                 AND F1.FLOWSN = F2.FLOWSN) B,TBSYS_ORGINFO A
          WHERE b.orgid in (SELECT a.dorgid  FROM TBFLOW_ORG_ORG a
                                    WHERE a.orgid = #{departid})  and B.orgid =A.orgid(+) 
        <if test="key!=null and key!=''"> and B.CONENT like '%'||#{key}||'%' </if>          
        <if test="sortField!=null and sortField!=''" > 
             order by ${sortField}  ${sortOrder}
        </if>
        ) a
        <if test="start!=null and start!=''">
             where rownum &lt;= #{end}
        </if> 
        )
       <if test="start!=null and start!=''">
             where  rn &gt;= #{start}
       </if>
	</select>
	
	<select id="getBaseListNotInformingCount" resultType="int" parameterType="Map">
	SELECT count(*)
  		FROM (SELECT a.*
            FROM (  SELECT B.FLOWDRAFTID,B.NOdeid,B.OPNAME,B.applyid, B.CONENT,B.APPLYDATETIME,
                           NVL (B.FLOWID, 0) AS FLOWID, A.name as orgid,B.NOdeid AS text1
                        FROM (SELECT F1.FLOWDRAFTID , F1.NOdeid,F1.OPNAME,F1.OPTIME,F1.orgid,T3.applyid,T3.conent,T3.APPLYDATETIME,
                                     DECODE (F1.FLOWDRAFTID, NULL, F1.FLOWDRAFTID,DECODE (F1.FLOWID, '', '1', '2')) AS FLOWID
                                   FROM TBFLOW F1,
                                            ( SELECT TF.FLOWDRAFTID, MAX (TO_NUMBER(TF.FLOWSN)) FLOWSN   FROM TBFLOW TF  GROUP BY TF.FLOWDRAFTID) F2,
                                            (SELECT applyid, FLOWDRAFTID,CONENT,APPLYDATETIME  FROM TBFLOW_BASE T1
                                   WHERE 1 = 1 
                                               <if test="flowdefid!=null and flowdefid!=''">
                                                     AND flowdefid = #{flowdefid}
                                               </if>
                                      AND NOT EXISTS  (SELECT 1  FROM TBFLOW_BASE T2  WHERE T1.APPLYID = T2.APPLYID
                                                                 AND T1.FLOWDEFID =T2.FLOWDEFID AND T2.OPTIME >T1.OPTIME)) T3                        
                           WHERE     F1.FLOWDRAFTID = T3.FLOWDRAFTID  AND F1.FLOWDRAFTID = F2.FLOWDRAFTID
                                 AND F1.FLOWSN = F2.FLOWSN) B,TBSYS_ORGINFO A
          			WHERE b.orgid in (SELECT a.dorgid  FROM TBFLOW_ORG_ORG a
                                    WHERE a.orgid = #{departid})  and B.orgid =A.orgid(+) 
					<if test="key!=null and key!=''"> and B.CONENT like '%'||#{key}||'%' </if>    
        	  ) a
        )
	</select>
	
	<delete id="deleteFlowBaseOtherDateByFlowdraftids" parameterType="Map" >
	    delete from tbflow_base_other t where t.otherid 
			in (select tb.otherid from tbflow_other_flow tb where tb.flowdraftid in(${flowdraftids}))
  	</delete>
  	
  	<delete id="deleteFlowOtherFlowDateByFlowdraftids" parameterType="Map" >
	    delete from tbflow_other_flow tb where tb.flowdraftid in(${flowdraftids})
  	</delete>
  	
  	<delete id="deleteFlowDateByFlowdraftids" parameterType="Map" >
	    delete from tbflow t where t.FLOWDRAFTID  in(${flowdraftids})
  	</delete>
  	
  	<delete id="deleteFlowBaseDateByFlowdraftids" parameterType="Map" >
	    delete from tbflow_base tcc where  tcc.flowdraftid in(${flowdraftids})
  	</delete>
   
    <delete id="deleteJXJSCPBByFlowdraftids" parameterType="Map" >
	    delete from NX_JXJS_CPB tcc where  tcc.flowdraftid in(${flowdraftids})
  	</delete>
   
    <update id="updateCaseNumberByFlowdraftid" parameterType="Map">
		update TBFLOW_BASE set 
		                  <if test="im == 1">
		                       text15 = substr(text6,1,4)||#{casenumber}
		                  </if>
		                  <if test="im != 1">
		                       text6 = substr(text6,1,4)||#{casenumber}
		                  </if>
		                  <if test="casetype!=null and casetype!=''" >
		                       ,text7 = #{casetype}
		                  </if>
		                  where flowdraftid = #{flowdraftid}
	</update>
	
	<update id="updateSignatureByFlowdraftid" parameterType="Map">
		update TBFLOW_BASE set text8 = #{signature} where flowdraftid = #{flowdraftid}
	</update>
	<!-- 宁夏分离签章进程 -->
	<update id="updateSignatureByFlowdraftid_nx" parameterType="Map">
		update TBFLOW_BASE set text8 = #{signature} where flowdraftid = #{flowdraftid}
	</update>
	
	<select id="selectSignaByCaseNum" resultType="Map" parameterType="Map">
		select * from (
			select a.*
			from TBFLOW_BASE a,TBPRISONER_BASE_CRIME info
			WHERE flowdefid=#{flowdefid} 
				AND text6=#{casenum}
				AND a.applyid=info.crimid
				AND a.departid=#{departid}
				<if test="casetype!=null and casetype!=''" >
		             AND a.text7=#{casetype}
		        </if>
				ORDER by a.optime desc
		) where rownum=1
	</select>
	
	<select id="getFuyiflagFromUvFlow" resultType="String" parameterType="Map">
		select fuyiflag from UV_FLOW t where t.flowdraftid=#{flowdraftid}
	</select>
	
	<select id="getDataFromUvFlow" resultType="Map" parameterType="Map">
		select * from UV_FLOW t where t.flowdraftid=#{flowdraftid}
	</select>
	
	<select id="getCourtCaseHandleInfo" resultType="Map" parameterType="Map">
		select t.applyid as crimid,t.orgid,t.flowdraftid,t.flowid,t.nodeid lastnodeid,t.fuyiflag from UV_FLOW t 
		where t.flowdefid=#{flowdefid}
		<if test="caseno!=null and caseno!=''" >
             and t.text6=#{caseno}
        </if>
		<if test="key!=null and key!=''" > 
			and (t.applyid like '%'||#{key}||'%' or t.applyname like '%'||#{key}||'%')
        </if>
	</select>
	
	<!-- 法院案件撤回 -->
	<select id="deleteFlowBaseCaseByanhao" parameterType="Map" resultType="int">
		delete from tbflow_base where flowdraftid =#{flowdraftid}
	</select>
	<delete id="deleteBaseOtherCase" parameterType="Map">
		delete from TBFLOW_BASE_OTHER a where a.otherid in 
		(select b.otherid  from TBFLOW_OTHER_FLOW b  where b.flowdraftid = #{flowdraftid})
	</delete>
	<delete id="deleteOtherFlowCase" parameterType="Map">
		delete from TBFLOW_OTHER_FLOW b where b.flowdraftid =#{flowdraftid}
	</delete>
	<delete id="deleteFlow" parameterType="Map">
		delete from tbflow d where d.flowdraftid =#{flowdraftid}
	</delete>
	<delete id="deleteFlowBaseDoc" parameterType="Map">
		delete from tbflow_base_doc d where d.flowdraftid =#{flowdraftid}
	</delete>
	<delete id="deleteCourtFlowBaseInfo" parameterType="Map">
		delete from TBCOURT_FLOW_BASEINFO d where d.flowdraftid =#{flowdraftid}
	</delete>
	<delete id="deleteCourtCaseFullCourt" parameterType="Map">
		delete from TBCOURT_CASEFULLCOURT d where d.INT1 =#{flowdraftid}
	</delete>
	<delete id="deleteCourtBiluInfo" parameterType="Map">
		delete from TBCOURT_BILU_INFO d where d.flowdraftid =#{flowdraftid}
	</delete>
	<!-- 获取减刑审核表显示数据flowbase -->
 	<select id="getParoleByFlowdraftid" parameterType="String" resultType="java.util.HashMap"> 
 		select 
			 t1.text6 casenum,
			 t1.int1 jxjs_1,
			 decode(t1.int1,0,'罪犯减刑审核表','罪犯假释审核表') jxorjs,
			 decode(t1.int1,0,'提请罪犯减刑审核表','提请罪犯假释审核表') jxorjs_hebei,
			 decode(t1.int1,0,'减字','假字') casetype,
			 '('||substr(t1.text6,0,4)||')'||T2.SHORTNAME||substr(t1.text6,4)||'号'  parolenumber,
			 '('||substr(t1.text6,0,4)||')'||T2.SHORTNAME||substr(t1.text6,4)||'号' text31,
			  t2.name departid,t2.fullname,
			  t3.orgname2 departid1
			from tbflow_base t1,
			tbsys_orginfo t2,
			TBPRISONER_BASE_CRIME t3
			
		where T1.DEPARTID = t2.orgid
		AND T1.applyid=t3.crimid
		<if test="flowdraftid!=null and flowdraftid!=''" > 
			and t1.flowdraftid = #{flowdraftid}
        </if>
 	</select>
 	<!-- 查询出 当前用户可以批注的个数  -->
 	<select id="ajaxNonationNumberMapper" resultType="map">
 	     SELECT TRS.*
			  FROM TBSYS_SIGNATURESCHEME trs,
			       (SELECT t.*
			          FROM (SELECT ts.*
			                    FROM TBSYS_SIGNATURESCHEME ts,
			                         TBSYS_RESOURCES tre,
			                         TBSYS_ROLE_RES trr,
			                         TBSYS_USERS_ROLES tur
			                   WHERE     trr.roleid = tur.roleid
			                         AND trr.resid = tre.resid
			                         <!-- tre.srurl = ts.signid -->
			                         and tre.resid = ts.resid
                         			 and ts.orgid = #{departid}
			                         and ts.tempid = #{tempid}
			                         and ts.flowdefid = #{flowdefid}
			                         AND tre.restypeid = '16'
			                         AND tur.userid = #{userid}
			                ORDER BY progress DESC) t
			         WHERE ROWNUM = 1) tb
		 	WHERE TRS.PROGRESS &lt;= tb.PROGRESS
		  	     and trs.orgid=#{departid}
                 and trs.tempid = #{tempid}
                 and trs.flowdefid = #{flowdefid}
 	</select>
 	<!-- 查询出到当前用户 一共可以再 表单上做多少个批注和签章  -->
 	<select id="ajaxNoShowNonationNumberMapper" resultType="map">
 		SELECT tme.*
			  FROM TBSYS_SIGNATURESCHEME tme,
			       (SELECT *
			          FROM (  SELECT ts.*
			                    FROM TBSYS_SIGNATURESCHEME ts,
			                         TBSYS_RESOURCES tre,
			                         TBSYS_ROLE_RES trr,
			                         TBSYS_USERS_ROLES tur
			                   WHERE     trr.roleid = tur.roleid
			                         AND trr.resid = tre.resid
			                         AND tre.srurl = ts.signid
			                         and ts.tempid = #{tempid}
			                         AND ts.flowdefid = #{flowdefid}
			                         AND tre.restypeid = '16'
			                         AND tur.userid = #{userid}
			                ORDER BY progress ASC)
			         WHERE ROWNUM = 1) tmrr
			 WHERE TME.PROGRESS &lt; tmrr.PROGRESS
			      and TME.ORGID = #{departid}
                  and TME.tempid = #{tempid}
                  and TME.flowdefid = #{flowdefid}
 	</select>
 	
 	<select id="ajaxGetDepartidNoShowNonationNumber" resultType="map">
 		select  distinct ts.orgid
        from TBSYS_SIGNATURESCHEME ts
        where ts.flowdefid=#{flowdefid}
        and ts.tempid = #{tempid}
 	</select>
 	
 	<select id="getMinPregerssByUserid" resultType="map">
 	      SELECT *
	          FROM (  SELECT ts.*
	                    FROM TBSYS_SIGNATURESCHEME ts,
	                         TBSYS_RESOURCES tre,
	                         TBSYS_ROLE_RES trr,
	                         TBSYS_USERS_ROLES tur
	                   WHERE     trr.roleid = tur.roleid
	                         AND trr.resid = tre.resid
	                         AND tre.srurl = ts.signid
	                         AND ts.tempid = #{tempid}
	                         AND ts.flowdefid = #{flowdefid}
	                         AND tre.restypeid = '16'
	                         AND tur.userid = #{userid}
	                ORDER BY progress asc)
	         WHERE ROWNUM = 1
 	</select>
 	
 	<select id="getSubmitPregerssByUserid" resultType="map">
 	      SELECT *
            FROM (  SELECT ts.*
                      FROM (
                            select  ts1.signid,ts1.progress,ts1.tempid,ts1.flowdefid,sum(ts2.seal) as signnumbers
                            from TBSYS_SIGNATURESCHEME ts1,TBSYS_SIGNATURESCHEME ts2
                            where ts1.flowdefid=#{flowdefid} and ts2.flowdefid=#{flowdefid}
                            and ts1.tempid = #{tempid} and ts2.tempid = #{tempid}
                            and ts1.progress >= ts2.progress
                            group by ts1.signid,ts1.progress,ts1.tempid,ts1.flowdefid
                            order by ts1.progress
                           ) ts,
                           TBSYS_RESOURCES tre,
                           TBSYS_ROLE_RES trr,
                           TBSYS_USERS_ROLES tur
                     WHERE     trr.roleid = tur.roleid
                           AND trr.resid = tre.resid
                           AND tre.srurl = to_char(ts.signid)
                           AND ts.flowdefid = #{flowdefid}
                           AND ts.signnumbers = #{signnumbers}
                           AND tre.restypeid = '16'
                           AND tur.userid = #{userid}
                     ORDER BY progress desc)
           WHERE ROWNUM = 1
 	</select>
 	
 	<!-- 根据罪犯编号 查询出对应的 刑种 -->
 	<select id="judgePunishmentByCrimid" resultType="map">
 	      SELECT
            case when TB.NOWPUNISHMENTYEAR ='9995' then 
                    1
                    when TB.NOWPUNISHMENTYEAR ='9996' then 
                    1
                    when TB.NOWPUNISHMENTYEAR ='9997' then 
                    1
                    else
                    0
	         end  as nowpun
		  FROM TBXF_SENTENCEALTERATION tb
		 WHERE tb.crimid = #{crimid}
 	</select>
 	
	<!-- 查询出最大的批次 -->
	<select id="maxBatchByDepartid" resultType="map" parameterType="java.lang.String">
	     SELECT *
		  FROM (  SELECT *
		            FROM TBXF_COMMUTEPAROLE_BATCH
		           WHERE departid = #{departid}
		                 AND curyear = (SELECT MAX (curyear)
		                                  FROM TBXF_COMMUTEPAROLE_BATCH
		                                 WHERE departid = #{departid})
		        ORDER BY batch DESC)
 		WHERE ROWNUM = 1
	</select>
    <!-- 方法描述：更新资格筛查表申报状态 -->
    <update id="updateIsdeclareByCrimid">
        update TBXF_SCREENING ts set ts.isdeclare=0   where ts.crimid=#{crimid} and ts.departid=#{departid}
    </update>
	<!-- 获取流程编号-->
	<select id="getFlowXuHao" resultType="String">
		SELECT nvl(count(applydatetime),0)+1 as flowxuhao FROM TBFLOW_BASE where 1=1 
		<if test="flowdefid!=null and flowdefid!=''">
			and flowdefid = #{flowdefid}
		</if>
		<if test="applyid!=null and applyid!=''">
			and applyid = #{applyid}
		</if>
		<if test="departid!=null and departid!=''">
			and departid = #{departid}
		</if>
		<if test="year!=null and year!=''">
			and to_char(APPLYDATETIME,'yyyy') = #{year}
		</if>	
	</select> 

    <select id="validateRecord" parameterType="Map" resultType="int"> 
    	select ISDECLARE from TBXF_SCREENING ts,
    		(select * from (select * from TBXF_COMMUTEPAROLE_BATCH tb where tb.departid=#{departid} order by curyear desc,batch desc) where rownum=1)  td
    	where ts.BATCHID = td.BATCHID
    	<if test="applyid!=null and applyid!=''">
    	and ts.CRIMID = #{applyid}
    	</if>
    	<if test="departid!=null and departid!=''">
    	and ts.DEPARTID = #{departid}
    	</if>
    	<if test="curyear!=null and curyear!=''">
    	and td.CURYEAR=#{curyear}
    	</if>
    	<if test="batch!=null and batch!=''">
		and td.BATCH = #{batch}
		</if>
    </select>
    <select id="getBingQingZhenDuan" parameterType="String" resultType="String">
    	select bcjd from (select text19 as bcjd from tbflow_base  where APPLYID=#{crimid} and text19  is not null order by APPLYDATETIME ) where rownum=1
    </select>
    <update id="update"
    	parameterType="com.sinog2c.model.flow.FlowBase">
    	update tbflow_base
    	<set>
    			INT1 = #{int1,jdbcType=DECIMAL},
    			INT2 = #{int2,jdbcType=DECIMAL},
    			INT3 = #{int3,jdbcType=DECIMAL},
    	</set>
    	where flowdefid = #{flowdefid,jdbcType=VARCHAR} and applyid=#{applyid,jdbcType=VARCHAR} and flowdraftid=#{flowdraftid,jdbcType=VARCHAR}
    </update>
    
    <!-- 查询省局解回再审的数据 -->
	<select id="getProvinceJHZSData" resultType="Map" parameterType="Map">
			SELECT *
  			FROM (SELECT a.*, ROWNUM rn
            			FROM (  
									select decode(uf.nodeid,'0','未审批','-1','未通过',
														 '1',decode(uf.text2,null,'已通过','已终止'),
														 DECODE (uf.flowid, NULL, '未审批','审批中')
											) as text3,
								       		uf.applyid,uf.applyname,
								       		uf.flowid,uf.optime,uf.opname,uf.conent,
								       		uf.text1,uf.text2,uf.flowdraftid
								 	from uv_flow uf
								 	where uf.applyid=#{applyid}
								 	and uf.flowdefid=#{flowdefid}
									<if test="sortField!=null and sortField!=''" > 
						             	order by ${sortField}  ${sortOrder}
						        	</if>
       					 ) a
			        <if test="end!=null and end!=''">
			             where rownum &lt;= #{end}
			        </if> 
	        )
	       <if test="start!=null and start!=''">
	             where  rn &gt;= #{start}
	       </if>
	 	
	</select>
	
	<!-- 查询省局解回再审的数据 -->
	<select id="countProvinceJHZSData" resultType="int" parameterType="Map">
		select count(uf.applyid)
	 	from uv_flow uf
	 	where uf.applyid=#{applyid}
	 	and uf.flowdefid=#{flowdefid}
	</select>
	<!-- 案件导出查询列表信息 -->
	<select id="findByCaseCondition" parameterType="Map" resultType="Map">
	 	select  distinct(t.crimid) as crimid,
		f.applyname as name,
		t.orgname2,
		t.INPRISONDATE
		from tbflow_base f left join 
		TBPRISONER_BASE_CRIME t 
		on f.applyid = t.crimid
		where 1=1
		<if test="conditionMessage!=null and conditionMessage!=''">
			and  ${conditionMessage}
		</if>
	</select>
	
	<select id="getCasenumsByCondition" parameterType="Map" resultType="Map">
	 	select  
	 		<if test="casetype!='100'">
            	f.text6
            </if>
            <if test="casetype=='100'">
            	<choose>
	                <when test="provincecode != departid" >
	                    f.text6
	                </when>
	                <when test="provincecode == departid" >
	                   f.text11
	                </when>    
	           </choose>
            </if> as casenum
		from tbflow_base f, TBPRISONER_BASE_CRIME t 
			where f.applyid = t.crimid and f.flowdefid = #{flowdefid}
		<if test="casetype!=null and casetype=='100'">
               and (f.int1 = 0 or f.int1 = 1)
               <choose>
	                <when test="provincecode != departid and casenums !=null" >
	                    and f.text6 in (${casenums})
	                </when>
	                <when test="provincecode == departid and casenums !=null" >
	                   and f.text11 in (${casenums})
	                </when>    
	           </choose>
        </if>
        <if test="casetype!=null and casetype!='100'">
         	and f.text7 = #{casetype}
         </if>
         <if test="casenums!=null and casetype!='100'">
         	AND f.text6 in (${casenums})
         </if>
		and (t.ORGID in (select dorgid from TBFLOW_ORG_ORG where orgid=#{orgid})
			or t.ORGID1 in (select dorgid from TBFLOW_ORG_ORG where orgid=#{orgid})
			or t.ORGID2 in (select dorgid from TBFLOW_ORG_ORG where orgid=#{orgid})
		)
	</select>
	
	<select id="getFlowdraftidsByCondition" parameterType="Map" resultType="Map">
	 	select  f.FLOWDRAFTID
		from tbflow_base f
		where 1=1
		<if test="flowdefid !=null">
			and f.flowdefid = #{flowdefid}
		</if>
		<if test="casetype!=null and casetype=='100'">
           	and (f.int1 = 0 or f.int1 = 1)
           	<choose>
				<when test="provincecode != departid and casenums !=null" >
					and f.text6 in (${casenums})
				</when>
				<when test="provincecode == departid and casenums !=null" >
				   and f.text11 in (${casenums})
				</when>	
			</choose>
        </if>
		<if test="casetype!=null and casetype!='100'">
           	and f.text7 = #{casetype, jdbcType=DECIMAL}
        </if>
        <if test="casenums !=null  and casetype!='100'">
			and f.text6 in (${casenums})
		</if>
        <if test="departid!=null">
        	and f.DEPARTID = #{departid}
        </if>
        <if test="text25!=null">
        	and f.text25 = #{text25}
        </if>
	</select>
	
	<select id="getUnDealFlowdraftids" parameterType="Map" resultType="Map">
	 	select  
	 		distinct f.FLOWDRAFTID, f.departid
		from tbflow_base f
		where 1=1
		and f.currnodeid='1' and f.state=1
        and exists (
        	 select 
		    	'x'
		    from TBFLOW_ARCHIVES_SETTING tas
		    where tas.INT1 = 1
			  and f.flowdefid=tas.flowdefid
			  and f.departid = tas.departid
        )
        and not exists (
        	select 'x' from TBFLOW_ARCHIVES_EXIST tae where f.flowdraftid = tae.flowdraftid
        )
	</select>
	
	<select id="getTextByflowdraftid" parameterType="Map" resultType="String">
	 	select  
	 		text8
		from tbflow_base 
		where flowid = (select flowid from uv_flow where flowdraftid = #{flowdraftid})
	</select>	
	<update id="updateTextByflowdraftid">
		update tbflow_base set text8= #{text8}
		where flowid = (select flowid from uv_flow where flowdraftid = #{flowdraftid})
	</update>
	<select id="getAnjianhaoByFlowdraftid"  parameterType="String" resultType="String">    <!-- 查询表中的所有流程信息 -->
		select '('||substr(t.text6,0,4)||')'||t.text24||t.text7||'第'||substr(t.text6,5)||'号' as anjianhao from tbflow_base t where t.flowdraftid = #{flowdraftid}
	</select>
	<update id="updateText25Byflowdraftid">
		update tbflow_base set text25= '1'
		where flowdraftid = #{flowdraftid}
	</update>
	
	 <update id="updateText23ById"
    	parameterType="com.sinog2c.model.flow.FlowBase">
    	update tbflow_base
    	<set>
    			text23 = #{text23,jdbcType=VARCHAR},
    	</set>
    	where  flowdraftid=#{flowdraftid,jdbcType=VARCHAR}
    </update>
	<select id="findUvFlowData" resultType="Map">
		select t.crimid, t.orgid from TBPRISONER_BASE_CRIME t where t.crimid in
       (select distinct (tt.applyid) from uv_flow tt  where tt.flowdefid in ('other_sjbwjysp', 'other_zfjyjxjssp')
           and tt.nodeid = '1' and tt.state = '1')
	</select>
	
	
	<!--  
		下面的sql语句只支持 oracle11g  R2，存在局限性
		select listagg(crimid, ',') within group(order by orgid) crimids,
       			 listagg(''''||flowdraftid||'''', ',') within group(order by orgid) flowdraftids,
       			 orgid as departid
	  from TBPRISONER_BASE_CRIME t,
	        TBFLOW_BASE tb
	    where t.crimid = tb.applyid
			 and tb.flowdraftid in (${flowdraftids})
			group by orgid
	-->
	<select id="findFlowBaseData" parameterType="Map" resultType="Map">
		select to_char(wm_concat(t.crimid)) crimids,
       			 to_char(wm_concat(''''||tb.flowdraftid||'''')) flowdraftids,
       			 t.orgid as departid
	    from TBPRISONER_BASE_CRIME t,
	        TBFLOW_BASE tb
	    where t.crimid = tb.applyid
			 and tb.flowdraftid in (${flowdraftids})
			group by t.orgid
	</select>
	
	<select id="getMastExistTempidOnFlow" parameterType="Map" resultType="String">
		select t.text5
		from TBFLOW_DELIVER t,
		     TBSYS_ROLE_RES res,
		     TBSYS_USERS_ROLES rol
		where t.flowdefid=#{flowdefid}
		  and t.departid=#{departid}
		  and t.state in (${state})
		  and t.resid=res.resid
		  and res.roleid=rol.roleid
		  and rol.userid=#{userid}
		  and t.resid=#{flowMenuid}
	</select>
	
	<update id="setSendedStatus" parameterType="Map">
		update tbflow_base
		set servicesender= #{sdstatus}
		where flowdraftid in (${flowdraftids})
	</update>
	
	<select id="distinguishFlowForwardOrEnd" parameterType="Map" resultType="Map">
		select    tb.flowdraftid, tb.text12
		from tbflow_base tb
		where tb.flowdraftid in (${flowdraftids})
	</select>
	
	<select id="distinguishSendToProvince" parameterType="Map" resultType="Map">
		<!-- select    
			tb.flowdraftid, 
			(case when tb.text12='2' or tb.text13='2' then '2' else '1' end) as text12 
		from tbflow_base tb
		where tb.flowdraftid in (${flowdraftids}) -->
		SELECT 
		       tb.flowdraftid,
		        (CASE WHEN sen.NOWPUNISHMENTYEAR = '9996' OR sen.NOWPUNISHMENTYEAR = '9995' 
		                 or instr(tbc.casenature,'黑恶势力犯罪')>0 
		                 or instr(tbc.casenature,'其它')>0 
		                 or instr(tbc.casenature,'原副处以下职务犯罪')>0 
		                 or instr(tbc.casenature,'原副处级以上职务犯罪')>0 
		                 or tbc.undermine = '是' or tbc.undermine = '1'
		                 or tbc.underworld= '是' or tbc.underworld = '1'
		                 or tbc.postcrime='是' or tbc.postcrime='1'
		         THEN '2'
		         ELSE '1'
		         END) AS text12
		 FROM TBXF_SENTENCEALTERATION sen,
		    tbprisoner_base_crime tbc,
		    tbflow_base tb
		 where sen.crimid=tbc.crimid
		   and tb.applyid=tbc.crimid
		   and tb.applyid=sen.crimid
		   and tb.flowdraftid in (${flowdraftids})
	</select>
	
	<select id="getAnnexcontent"  resultType="string">
	     select tb.ANNEXCONTENT  from SX_TBPUBLIC_FILE_ANNEX_A tb  
	     where   tb.xuhao='1' and tb.antype='SDXF_BASE_RJDJB' and tb.criminalid=#{crimid}
    </select>
    <select id="getAllCrimid" resultType="com.sinog2c.model.prisoner.TbprisonerBaseinfo">
		select tb.criminalid as crimid from SX_TBPUBLIC_FILE_ANNEX_A tb  
	     where   tb.xuhao='1' and tb.antype='SDXF_BASE_RJDJB' and tb.ANNEXCONTENT is not null order by criminalid desc
    </select>
    <!-- 查询是否有重复的案件号 -->
	<select id="ajaxGetRepeatAnHao" parameterType="Map" resultType="String">
		select t.text6 from tbflow_base t where t.text6=#{curyear}||#{parolenumber} and t.flowdefid=#{flowdefid} 
		<if test="int1 == 0 or int1 == 4">
			and t.int1 in (0,4)
		</if>
		<if test="int1 == 1">
			and t.int1 = #{int1}
		</if>
	</select>
	<!-- 获取案件类型 -->
	<select id="getAnJianTypeList" parameterType="Map" resultType="Map" >
		select  distinct(T.FLOWDEFID) flowdefid,T.REMARK  from TBFLOW_DELIVER t,UV_FLOW u 
		where U.FLOWDEFID=T.FLOWDEFID and T.DEPARTID=#{departid}
	</select>
	
	<select id="getBackNodeidByCurrnodeid" resultType="String" parameterType="map" >
	 	select userid from (
			 SELECT userid FROM TBFLOW_PERSONAPPROVE
		 	 where 1 = 1
		 	    and flowdraftid = #{flowdraftid}
		 	    and duserid = #{nodeid}
		 	    and text1='yes'
		 	   order by optime desc
	 	 ) where rownum=1
   </select>
  
   <select id="getUnitlevel" resultType="String">
    select unitlevel from tbsys_orginfo where orgid = #{departid}
   </select>
   
   <select id="getTianBiaoRen" resultType="com.sinog2c.model.flow.FlowBase">
	   select * from tbflow_base a where applyid = #{applyid} and flowdefid = 'doc_zfrjdjsp' and applydatetime = (select max(applydatetime) from tbflow_base b where b.applyid = a.applyid)
   </select>
   <!-- 查询非本人加锁的案件 -->
   <select id="selectUnable2unLockCases" resultType="Map"
		parameterType="Map">
		select t.flowdraftid,t.applyid,t.applyname
		from
		tbflow_base t
		where t.flowdraftid in (${flowdraftids})
		and t.ISLOCKED = 1
		and t.opid != #{userid}
    </select>
   <select id="countListWork" parameterType="Map" resultType="int">
  		select count(*) from (
  		      select distinct o.name areaname,us.duty,t.* from tbsys_orginfo o,UV_Flow u,tbflow_base t,tbsys_userinfo us
		          where   1=1
		                 and us.userid=t.applyid
		                 and u.orgid=o.orgid
		                 and t.flowdefid=u.flowdefid
		                 and t.applyid=u.applyid
		                 and t.applyid=#{userid}
			<if test="flowdefid != null and flowdefid != ''">
		  		and t.flowdefid in (${flowdefid})
		  	</if> 
		  	<if test="key != null and key != ''">
		  		and t.conent like concat(concat('%', #{key}), '%')
		  	</if>
		  	<if test="flowdid != null and flowdid != ''">
		  		and t.flowdid like concat(concat('%', #{flowdid}), '%')
		  	</if>
		  	)
  </select>
  <select id="listWork" parameterType="Map" resultType="Map">
	  	select * from( 
			select a.*, rownum rn from(
	    		 select distinct o.name areaname,
	    		   decode(u.nodeid,'0','未审批','-1','未通过','1',decode(u.text2,null,'已通过','已终止'),DECODE (u.flowid, NULL, '未审批','审批中')) as jincheng,us.duty,
	    		   t.* from tbsys_orginfo o,UV_Flow u,tbflow_base t,tbsys_userinfo us
			      where  1=1
			         and us.userid=t.applyid
			         and u.orgid=o.orgid
			         and t.flowdefid=u.flowdefid
			         and t.applyid=u.applyid
			         and t.applyid=#{userid}
	    		<if test="flowdefid != null and flowdefid != ''">
			  		and t.flowdefid in (${flowdefid})
			  	</if>
			  	<if test="key != null and key != ''">
			  		and t.conent like concat(concat('%', #{key}), '%')
			  	</if>
			  	<if test="flowdid != null and flowdid != ''">
			  		and t.flowdid like concat(concat('%', #{flowdid}), '%')
			  	</if>
			    ) a 
		    <if test="end !=null and end !=''">
		   		where rownum &lt;= #{end}
		   	</if>
		   	)
	   	<if test="start !=null and start !=''">
	   		where  rn &gt;= #{start}
	   	</if>
  </select>
  <delete id="deleteById" parameterType="String" flushCache="true"> <!-- 根据归档id 删除流程基本表信息 -->
		delete from tbflow_base t where t.flowid in (select n.flowid from
		TBFLOW_ARCHIVES n where n.archiveid=#{archiveid} )
  </delete>
  <!-- 查询案件省局是否立过案 -->
  <select id="findByFlowDraftid" parameterType="String"
		resultType="String">
		select t.text11 from tbflow_base t where
		t.flowdraftid=#{flowdraftid}
  </select>
  <select id="getOrgLevelByFlowdraftid" parameterType="Map"
		resultType="String">
		select org.unitlevel
		from tbflow_base tb,
		TBPRISONER_BASE_CRIME tbc,
		TBSYS_ORGINFO org
		where tb.flowdraftid=#{flowdraftid}
		and tb.applyid = tbc.crimid
		and tbc.orgid2 = org.orgid
   </select>
   <select id="exeProcdeure" parameterType="String" statementType="CALLABLE">
		<if test="sql!=null and sql!=''">${sql}</if>
   </select>
   <insert id="insertTbflowCaseCriminal" parameterType="Map">
		insert into TBFLOW_CASE_CRIMINAL (CRIMID, FLOWDRAFTID, FLOWDEFID,DEPARTID,
		STATE)
		select CRIMID,S_CREATE_FLOWDRAFTID.NEXTVAL
		||f_getcurrenttime||replace(replace(substr(ORGID,1,4),'c',''),'C','')
		FLOWDRAFTID ,
		${flowdefid} FLOWDEFID,ORGID, 3 STATE
		from Tbprisoner_Base_Crime t
		where t.crimid IN (${crimids})
		and not exists(SELECT 'X' FROM TBFLOW_CASE_CRIMINAL S WHERE
		T.CRIMID=S.CRIMID AND S.FLOWDEFID IN (${flowdefid}))
   </insert>
   <update id="updateTbflowCaseCriminalFlow" parameterType="Map">
		UPDATE TBFLOW_CASE_CRIMINAL R SET FLOWDRAFTID=
		S_CREATE_FLOWDRAFTID.NEXTVAL
		||f_getcurrenttime||replace(replace(substr(DEPARTID,1,4),'c',''),'C','')
		WHERE R.CRIMID IN (${crimids}) AND R.FLOWDEFID IN (${flowdefid})
   </update>
   <update id="updateTbflowCaseCriminalDep" parameterType="Map">
		UPDATE TBFLOW_CASE_CRIMINAL R SET (DEPARTID,STATE)=(
		SELECT ORGID DEPARTID,3 STATE
		FROM (
		select ORGID, CRIMID
		from Tbprisoner_Base_Crime t
		WHERE EXISTS (SELECT 'X' FROM TBFLOW_CASE_CRIMINAL S WHERE
		T.CRIMID=S.CRIMID AND S.FLOWDEFID IN (${flowdefid})))B
		WHERE R.CRIMID=B.CRIMID AND B.CRIMID IN (${crimids}) ) WHERE R.FLOWDEFID IN
		(${flowdefid}) AND
		EXISTS(SELECT 'X' FROM Tbprisoner_Base_Crime S WHERE S.CRIMID=R.CRIMID AND S.CRIMID
		IN (${crimids}))
	</update>
	
	
	<select id="getCaseTypeFromShengju" resultType="Map">
	SELECT distinct
   		(CASE WHEN sen.NOWPUNISHMENTYEAR = '9996' OR sen.NOWPUNISHMENTYEAR = '9995' 
         THEN '无期、死缓' 
         else '重要罪犯、三类犯'
   		 END
   		) AS casecombo,
   		(CASE WHEN sen.NOWPUNISHMENTYEAR = '9996' OR sen.NOWPUNISHMENTYEAR = '9995' 
         then '1'
         else '2'
         END
        ) AS casetype
  	FROM TBXF_SENTENCEALTERATION sen,tbprisoner_base_crime tbc
  	where sen.crimid=tbc.crimid
   </select>
   
   
   
   
   
   
   	<select id="distinguishFinishAtSJCZ" parameterType="Map" resultType="Map">
	SELECT 
				tb.flowdraftid,
			   (CASE WHEN sen.NOWPUNISHMENTYEAR = '9996' OR sen.NOWPUNISHMENTYEAR = '9995' 
			    THEN '2'
			          WHEN tbc.casenature is not null
			          or tbc.undermine = '是' or tbc.undermine = '1'
			          or tbc.underworld= '是' or tbc.underworld = '1'
			          or tbc.postcrime='是' or tbc.postcrime='1'
			    THEN '1'
			    ELSE '0'
			    END) AS operatesymbol
	FROM TBXF_SENTENCEALTERATION sen,
	   tbprisoner_base_crime tbc,
	   tbflow_base tb
	where sen.crimid=tbc.crimid
	  and tb.applyid=tbc.crimid
	  and tb.applyid=sen.crimid
	  and tb.flowdraftid in (${flowdraftids})
	</select>
	
	
	
	<select id="getStateFromTbflowBase" resultType="String">    <!-- 查询表中的所有流程信息 -->
		select t.state from tbflow_base t where t.flowdraftid = #{flowdraftid}
	</select>
	
</mapper>